<ion-header>
  <ion-navbar color="primary" class="align-toolbar">
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title><div class="nearby-wrapper"><img src="assets/imgs/logo-header.svg"></div></ion-title>
    <ion-buttons end>
      <button ion-button icon-start large [disabled]="togglingView" (touchend)="toggleView()"><ion-icon *ngIf="view == 'list'" name="map"></ion-icon><ion-icon *ngIf="view == 'map'" name="list"></ion-icon><span *ngIf="view == 'list'">Map</span><span *ngIf="view == 'map'">List</span></button>
    <!--<button ion-button clear class="options-button" (click)="toggleToolbar()">-->
        <!--<span *ngIf="showToolbar">Hide</span>-->
        <!--<span *ngIf="!showToolbar">Show</span>-->
      <!--</button>-->
    </ion-buttons>
  </ion-navbar>
  <ion-toolbar class="dateToolbar" *ngIf="view == 'map'">
    <ion-grid>
      <ion-row>
        <ion-col col-7>
          <ion-item class="datetime-sm">
            <ion-label fixed><ion-icon name="calendar" color="primary"></ion-icon></ion-label>
            <ion-datetime displayFormat="DDD, MMM DD" pickerFormat="MMM DDDD" [min]="today" [max]="maxDate" [(ngModel)]="date" (ionCancel)="logDate('cancelled', date);" (ionChange)="rankRestaurants(restaurantAll); logDate('changed', date);"></ion-datetime>
          </ion-item>
        </ion-col>
        <ion-col col-5>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content [ngClass]="{'grey-background': view == 'list'}">
  <ion-refresher *ngIf="view == 'list'" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content>
    </ion-refresher-content>
  </ion-refresher>
  <div *ngIf="view == 'list'">
    <ion-card *ngIf="customLocation" class="info-card">
      <ion-card-content>
        <ion-icon name="information-circle"></ion-icon>
        <p>Not using your device's location.</p>
      </ion-card-content>
    </ion-card>
    <ion-grid class="section-header top-picks">
      <ion-row>
        <ion-col>
          <h4>Today's Top 5 Picks</h4>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-slides class="top-pick-slider" spaceBetween="-15" pager="true" (ionSlideNextStart)="topPickSlider('next')" (ionSlidePrevStart)="topPickSlider('previous')">
      <ion-slide class="top-pick-slide" *ngFor="let restaurant of restaurantPicks">
        <restaurant-card [cardType]="'top-pick'" [location]="userCoords" [restaurant]="restaurant" [date]="date" [time]="time"></restaurant-card>
      </ion-slide>
    </ion-slides>
    <ion-grid class="section-header deals-nearby">
      <ion-row>
        <ion-col>
          <h4>Deals Nearby</h4>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-list>
      <restaurant-card *ngFor = "let restaurant of restaurantList; let i = index" [cardType]="'standard'" [location]="userCoords" [restaurant]="restaurant" [date]="date" [time]="time"></restaurant-card>
    </ion-list>
    <div class="load-more">
      <button class="blue-text" *ngIf="loadMorePressed < 2" ion-button icon-start block color="white" (tap)="loadMore()"><ion-icon name="arrow-dropdown-circle"></ion-icon>Show More Restaurants</button>
      <span class="search-more" *ngIf="loadMorePressed >= 2">Hungry for more?<button ion-button small color="secondary" (tap)="goToSearch()">Search</button></span>
    </div>
  </div>
  <div *ngIf="view == 'map'" [ngClass]="{'hideMap' : hideMap}" class="map-container">
    <div id="mapCanvas" [ngClass]="{'hidden': view == 'list'}"></div>
    <ion-card *ngIf="selectedResto.hasOwnProperty('name')" class="map-resto-card">
      <ion-grid class="no-padding">
        <ion-row>
          <ion-col col-8 align-self-stretch class="first-row border-right">
            <button class="button-wrapper"  (tap)="navigateTo($event, '')" ion-item detail-none>
              <h2>{{selectedResto.name}}</h2>
              <p class="tags"><span *ngFor="let category of selectedResto?.categories; let i = index">{{category}}<span *ngIf="i < selectedResto.categories.length - 1">, </span></span></p>
              <div class="card-row">
                <p class="rating"><ion-icon name="star"></ion-icon><span *ngIf="selectedResto.rating">{{selectedResto.rating.ratingNumber}}</span><span class="na" *ngIf="!selectedResto.rating">N/A</span></p>
                <div class="price">
                  <p [ngClass]="selectedResto.price >= 1 ? 'active' : ''">$</p>
                  <p [ngClass]="selectedResto.price >= 2 ? 'active' : ''">$</p>
                  <p [ngClass]="selectedResto.price >= 3 ? 'active' : ''">$</p>
                  <p [ngClass]="selectedResto.price == 4 ? 'active' : ''">$</p>
                </div>
              </div>
            </button>
          </ion-col>
          <ion-col col-4 nowrap align-self-stretch class="align-center first-row vertical-align-col">
            <button ion-button class="best-deal" *ngIf="selectedResto?.maxTimeslot" (tap)="navigateTo($event, selectedResto.maxTimeslot._id)">
              <div class="deal-header">
                <p class="title">BEST DEAL</p>
              </div>
              <div class="deal-details">
                <p class="discount">-{{selectedResto?.maxTimeslot.discount}}%</p>
                <p class="time">@{{functions.formatClockTime(selectedResto.maxTimeslot.time, true)}}</p>
              </div>
            </button>
            <div *ngIf="!selectedResto.timeslots.length">
              <p>Coming Soon</p>
            </div>
            <div *ngIf="selectedResto.timeslots.length > 0 && timeslotsLength <= 0">
              <p *ngIf="date != today">No deals for {{date | date: 'MMM d'}}</p>
              <p *ngIf="date == today">No more deals today</p>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>
  </div>
</ion-content>
