<ion-header>
  <ion-navbar color="primary" class="align-toolbar">
    <ion-title><div class="nearby-wrapper"><img src="assets/imgs/logo-header.svg"></div></ion-title>
    <ion-buttons end>
      <button ion-button [disabled]="togglingView" (touchend)="toggleView()"><span *ngIf="view == 'list'">Map View</span><span *ngIf="view == 'map'">List View</span></button>
    <!--<button ion-button clear class="options-button" (click)="toggleToolbar()">-->
        <!--<span *ngIf="showToolbar">Hide</span>-->
        <!--<span *ngIf="!showToolbar">Show</span>-->
      <!--</button>-->
    </ion-buttons>
   </ion-navbar>
  <ion-toolbar class="dateToolbar">
    <ion-grid>
      <ion-row>
        <ion-col col-7>
          <ion-item class="datetime-sm">
            <ion-label fixed><ion-icon name="calendar" color="primary"></ion-icon></ion-label>
            <ion-datetime displayFormat="DDD, MMM DD" pickerFormat="MMM DDDD" [min]="today" [max]="maxDate" [(ngModel)]="date" (ionChange)="rankRestaurants(restaurantAll)"></ion-datetime>
          </ion-item>
        </ion-col>
        <ion-col col-5>
          <ion-item class="datetime-sm">
            <ion-label fixed><ion-icon name="clock" color="primary"></ion-icon></ion-label>
            <ion-datetime displayFormat="h:mm A" pickerFormat="h:mm A" minuteValues="0,30" [(ngModel)]="time"></ion-datetime>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content [ngClass]="{'grey-background': view == 'list'}">
  <ion-refresher *ngIf="view == 'list'" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content>
    </ion-refresher-content>
  </ion-refresher>
  <div *ngIf="view == 'list'">
    <ion-list>
      <restaurant-card *ngFor = "let restaurant of restaurantList; let i = index" [location]="location" [restaurant]="restaurant" [date]="date" [time]="time"></restaurant-card>
    </ion-list>
    <ion-infinite-scroll *ngIf="!allResults" threshold="1500px" (ionInfinite)="getNextBatch($event)">
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
    <ion-grid *ngIf="allResults">
      <ion-row>
        <ion-col align-items-center>
          <p class="align-center">That's all she's got, Captain.</p>
          <p class="align-center">Know any restaurants you would like to see? Let us know!</p>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
  <div *ngIf="view == 'map'" class="map-container">
    <div id="mapCanvas" [ngClass]="{'hidden': view == 'list'}"></div>
    <ion-card *ngIf="selectedResto.hasOwnProperty('name')" class="map-resto-card">
      <ion-grid class="no-padding">
        <ion-row>
          <ion-col col-8 align-self-stretch class="first-row border-right">
            <button class="button-wrapper"  (tap)="navigateTo($event, '')" ion-item detail-none>
              <h2>{{selectedResto.name}}</h2>
              <p class="tags"><span *ngFor="let category of selectedResto?.categories; let i = index">{{category}}<span *ngIf="i < selectedResto.categories.length - 1">, </span></span></p>
              <div class="card-row">
                <p class="rating"><ion-icon name="star"></ion-icon><span *ngIf="selectedResto.rating">{{selectedResto.rating.ratingNumber}}</span><span class="na" *ngIf="!selectedResto.rating">N/A</span></p>
                <div class="price">
                  <p [ngClass]="selectedResto.price >= 1 ? 'active' : ''">$</p>
                  <p [ngClass]="selectedResto.price >= 2 ? 'active' : ''">$</p>
                  <p [ngClass]="selectedResto.price >= 3 ? 'active' : ''">$</p>
                  <p [ngClass]="selectedResto.price == 4 ? 'active' : ''">$</p>
                </div>
              </div>
              <p *ngIf="openStatus == 'open'" class="open"><span class="prefix">Open Now</span> {{functions.formatClockTime(businessHours[0], true)}} - {{functions.formatClockTime(businessHours[1], true)}}<span *ngIf="businessHours.length == 4">, {{functions.formatClockTime(businessHours[2], true)}} - {{functions.formatClockTime(businessHours[3], true)}}</span></p>
              <p *ngIf="openStatus == 'willOpen' || openStatus == 'closed'" class="closed"><span class="prefix">Closed</span> {{functions.formatClockTime(businessHours[0], true)}} - {{functions.formatClockTime(businessHours[1], true)}}<span *ngIf="businessHours.length == 4">, {{functions.formatClockTime(businessHours[2], true)}} - {{functions.formatClockTime(businessHours[3], true)}}</span></p>
              <p *ngIf="openStatus == 'closedToday'" class="closed"><span class="prefix">Closed Today</span></p>
            </button>
          </ion-col>
          <ion-col col-4 nowrap align-self-stretch class="align-center first-row vertical-align-col">
            <button ion-button class="best-deal" *ngIf="selectedResto?.maxTimeslot" (tap)="navigateTo($event, selectedResto.maxTimeslot._id)">
              <div class="deal-header">
                <p class="title">BEST DEAL</p>
              </div>
              <div class="deal-details">
                <p class="discount">-{{selectedResto?.maxTimeslot.discount}}%</p>
                <p class="time">@{{functions.formatClockTime(selectedResto.maxTimeslot.time, true)}}</p>
              </div>
            </button>
            <div *ngIf="!selectedResto.timeslots.length">
              <p>Coming Soon</p>
            </div>
            <div *ngIf="selectedResto.timeslots.length > 0 && timeslotsLength <= 0">
              <p *ngIf="date != today">No deals for {{date | date: 'MMM d'}}</p>
              <p *ngIf="date == today">No more deals today</p>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>
  </div>
</ion-content>
